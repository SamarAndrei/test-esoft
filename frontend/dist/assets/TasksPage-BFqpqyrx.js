import{r as s,u as O,j as e,C,F as V,I as N,S as $,M as g,a as L,b as R,G as y,P as W,T as o,c as q,d as k,U as z}from"./index-C0qkDD7e.js";const B=(n,d)=>{const i=new Date().toISOString().split("T")[0];return d=d.split("T")[0],n==="выполнена"?"green":new Date(d)<new Date(i)?"red":"gray"},H=({setGrouping:n})=>{const[d,i]=s.useState(""),f=O(u=>u.user),x=u=>{const l=u.target.value;i(l),n(l)};return e.jsx(C,{sx:{mt:12},children:e.jsxs(V,{fullWidth:!0,children:[e.jsx(N,{id:"demo-simple-select-label",children:"Группировка по:"}),e.jsxs($,{value:d,onChange:x,children:[e.jsx(g,{value:"none",children:"Без группировки"}),e.jsx(g,{value:"today",children:"На сегодня"}),e.jsx(g,{value:"week",children:"На неделю"}),e.jsx(g,{value:"future",children:"На будущее"}),f.role==="Руководитель"&&e.jsx(g,{value:"assignee",children:"По ответственным(А-Я)"})]})]})})},J=()=>{const[n,d]=s.useState(""),[i,f]=s.useState([]),[x,u]=s.useState([]),[l,D]=s.useState({}),[I,S]=s.useState(!1),[j,T]=L(),[a,c]=s.useState(null),[b,w]=s.useState({title:"",description:"",priority:"",due_date:"",status:"",assigneeId:""}),{isValid:v}=R(b),U=t=>{c(t),S(!0)},G=()=>{S(!1),c(null)},P=t=>{if(!a)return;const{id:r,createdAt:m,updatedAt:p,creatorId:h,due_date:A,...E}=a,M=new Date(A.split("T")[0]),F={...E,due_date:M};w(F),v&&(t.target.name==="due_date"?c({...a,[t.target.name]:new Date(t.target.value).toISOString()}):c({...a,[t.target.name]:t.target.value}))},_=async()=>{if(a){const{id:t,createdAt:r,updatedAt:m,creatorId:p,...h}=a;await k.updateTask(a.id,h),S(!1),c(null)}};return s.useEffect(()=>{T(n?{sort:n}:{sort:"none"})},[n]),s.useEffect(()=>{(async()=>{try{const r=await k.getAllTask(j);f(r.data)}catch(r){console.error(r,"Ошибка запроса задач")}})()},[j,a]),s.useEffect(()=>{(async()=>{try{const r=await z.fetchUsers();u(r.data);const m=r.data.reduce((p,h)=>(p[h.id]=h,p),{});D(m)}catch(r){console.error(r,"Ошибка запроса пользователей")}})()},[i]),e.jsxs(C,{sx:{mt:12},children:[e.jsx(H,{setGrouping:d}),e.jsxs(y,{container:!0,spacing:1,sx:{mt:4},children:[i.length>0?i.map(t=>e.jsx(y,{item:!0,xs:12,sm:6,md:4,onClick:()=>U(t),children:e.jsxs(W,{elevation:3,style:{padding:16,cursor:"pointer"},children:[e.jsx(o,{variant:"h6",style:{color:B(t.status,t.due_date)},children:t.title}),e.jsxs(o,{variant:"body2",children:["Приоритет: ",t.priority]}),e.jsxs(o,{variant:"body2",children:["Дата окончания: ",t.due_date.split("T")[0]]}),e.jsxs(o,{variant:"body2",children:["Статус: ",t.status]}),e.jsxs(o,{variant:"body2",children:["Ответственный: ",l[t.assigneeId]?`${l[t.assigneeId].firstName} ${l[t.assigneeId].lastName}`:"Загрузка..."]})]})},t.id)):e.jsx(o,{children:" У вас нет задач "}),e.jsx(q,{open:I,handleClose:G,taskData:a,setTaskData:c,handleChange:P,handleSubmitCreate:()=>{},handleSubmitUpdate:_,users:x,isValid:v,editingTask:a})]})]})},Q=()=>e.jsx("div",{children:e.jsx(J,{})});export{Q as default};
