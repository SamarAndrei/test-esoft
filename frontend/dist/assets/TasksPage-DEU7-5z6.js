import{r as t,u as O,j as e,C,F as V,I as N,S as $,M as p,a as L,b as R,G as y,P as W,T as o,c as q,d as z,e as k,U as B}from"./index-B6sk89kx.js";const H=(n,i)=>{const d=new Date().toISOString().split("T")[0];return i=i.split("T")[0],n==="выполнена"?"green":new Date(i)<new Date(d)?"red":"gray"},J=({setGrouping:n})=>{const[i,d]=t.useState(""),x=O(u=>u.user),f=u=>{const l=u.target.value;d(l),n(l)};return e.jsx(C,{sx:{mt:12},children:e.jsxs(V,{fullWidth:!0,children:[e.jsx(N,{id:"demo-simple-select-label",children:"Группировка по:"}),e.jsxs($,{value:i,onChange:f,children:[e.jsx(p,{value:"none",children:"Без группировки"}),e.jsx(p,{value:"today",children:"На сегодня"}),e.jsx(p,{value:"week",children:"На неделю"}),e.jsx(p,{value:"future",children:"На будущее"}),x.role==="Руководитель"&&e.jsx(p,{value:"assignee",children:"По ответственным(А-Я)"})]})]})})},K=()=>{const[n,i]=t.useState(""),[d,x]=t.useState([]),[f,u]=t.useState([]),[l,D]=t.useState({}),[I,S]=t.useState(!1),[m,T]=L(),[a,c]=t.useState(null),[b,w]=t.useState({title:"",description:"",priority:"",due_date:"",status:"",assigneeId:""}),{isValid:v}=R(b),U=s=>{c(s),S(!0)},G=()=>{S(!1),c(null)},P=s=>{if(!a)return;const{id:r,createdAt:j,updatedAt:g,creatorId:h,due_date:A,...E}=a,M=new Date(A.split("T")[0]),F={...E,due_date:M};w(F),v&&(s.target.name==="due_date"?c({...a,[s.target.name]:new Date(s.target.value).toISOString()}):c({...a,[s.target.name]:s.target.value}))},_=async()=>{if(a){const{id:s,createdAt:r,updatedAt:j,creatorId:g,...h}=a;await k.updateTask(a.id,h),S(!1),c(null)}};return t.useEffect(()=>{T(n?{sort:n}:{sort:"none"})},[n]),t.useEffect(()=>{(async()=>{try{const r=await k.getAllTask(m);x(r.data)}catch(r){console.error(r,"Ошибка запроса задач")}})()},[m,a]),t.useEffect(()=>{(async()=>{try{const r=await B.fetchUsers();u(r.data);const j=r.data.reduce((g,h)=>(g[h.id]=h,g),{});D(j)}catch(r){console.error(r,"Ошибка запроса пользователей")}})()},[d]),e.jsxs(C,{sx:{mt:12},children:[e.jsx(J,{setGrouping:i}),e.jsxs(y,{container:!0,spacing:1,sx:{mt:4},children:[d.length>0?d.map(s=>e.jsx(y,{item:!0,xs:12,sm:6,md:4,onClick:()=>U(s),children:e.jsxs(W,{elevation:3,style:{padding:16,cursor:"pointer"},children:[e.jsx(o,{variant:"h6",style:{color:H(s.status,s.due_date)},children:s.title}),e.jsxs(o,{variant:"body2",children:["Приоритет: ",s.priority]}),e.jsxs(o,{variant:"body2",children:["Дата окончания: ",s.due_date.split("T")[0]]}),e.jsxs(o,{variant:"body2",children:["Статус: ",s.status]}),e.jsxs(o,{variant:"body2",children:["Ответственный: ",l[s.assigneeId]?`${l[s.assigneeId].firstName} ${l[s.assigneeId].lastName}`:e.jsx(q,{})]})]})},s.id)):e.jsx(o,{children:" У вас нет задач "}),e.jsx(z,{open:I,handleClose:G,taskData:a,setTaskData:c,handleChange:P,handleSubmitCreate:()=>{},handleSubmitUpdate:_,users:f,isValid:v,editingTask:a})]})]})},X=()=>e.jsx("div",{children:e.jsx(K,{})});export{X as default};
